{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createOfflineMiddleware = void 0;\n\nvar _constants = require(\"./constants\");\n\nvar _actions = require(\"./actions\");\n\nvar _send = _interopRequireDefault(require(\"./send\"));\n\nvar after = function after() {\n  var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  return new Promise(function (resolve) {\n    return setTimeout(resolve, timeout);\n  });\n};\n\nvar createOfflineMiddleware = function createOfflineMiddleware(config) {\n  return function (store) {\n    return function (next) {\n      return function (action) {\n        // allow other middleware to do their things\n        var result = next(action);\n        var promise; // find any actions to send, if any\n\n        var state = store.getState();\n        var offline = config.offlineStateLens(state).get;\n        var context = {\n          offline: offline\n        };\n        var offlineAction = config.queue.peek(offline.outbox, action, context); // create promise to return on enqueue offline action\n\n        if (action.meta && action.meta.offline) {\n          var registerAction = config.offlineActionTracker.registerAction;\n          promise = registerAction(offline.lastTransaction);\n        } // if there are any actions in the queue that we are not\n        // yet processing, send those actions\n\n\n        if (offlineAction && !offline.busy && !offline.retryScheduled && offline.online) {\n          (0, _send.default)(offlineAction, store.dispatch, config, offline.retryCount);\n        }\n\n        if (action.type === _constants.OFFLINE_SCHEDULE_RETRY) {\n          after(action.payload.delay).then(function () {\n            store.dispatch((0, _actions.completeRetry)(offlineAction));\n          });\n        }\n\n        if (action.type === _constants.OFFLINE_SEND && offlineAction && !offline.busy) {\n          (0, _send.default)(offlineAction, store.dispatch, config, offline.retryCount);\n        }\n\n        return promise || result;\n      };\n    };\n  };\n};\n\nexports.createOfflineMiddleware = createOfflineMiddleware;","map":null,"metadata":{},"sourceType":"script"}